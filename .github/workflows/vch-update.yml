name: VCH Update Workflow

on:
  push:
    branches: [ main ]
  workflow_dispatch:

jobs:
  deploy:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        
      - name: Split Changelog
        id: changelog
        run: |
          # Read the changelog content
          CHANGELOG_CONTENT=$(cat CHANGELOG.md)
          
          # Split into chunks of 1900 characters each
          echo "part1<<EOF" >> $GITHUB_OUTPUT
          echo "${CHANGELOG_CONTENT:0:1900}" >> $GITHUB_OUTPUT
          echo "EOF" >> $GITHUB_OUTPUT
          
          if [ ${#CHANGELOG_CONTENT} -gt 1900 ]; then
            echo "part2<<EOF" >> $GITHUB_OUTPUT
            echo "${CHANGELOG_CONTENT:1900:1900}" >> $GITHUB_OUTPUT
            echo "EOF" >> $GITHUB_OUTPUT
          fi
          
          if [ ${#CHANGELOG_CONTENT} -gt 3800 ]; then
            echo "part3<<EOF" >> $GITHUB_OUTPUT
            echo "${CHANGELOG_CONTENT:3800}" >> $GITHUB_OUTPUT
            echo "EOF" >> $GITHUB_OUTPUT
          fi
        
      - name: Send Changelog Part 1 to Discord
        if: success()
        uses: Ilshidur/action-discord@0.3.2
        env:
          DISCORD_WEBHOOK: ${{ secrets.DISCORD_WEBHOOK }}
        with:
          args: |
            **ðŸ“‹ VCH Changelog (Part 1/3)**
            ${{ steps.changelog.outputs.part1 }}
            
      - name: Send Changelog Part 2 to Discord
        if: success() && steps.changelog.outputs.part2 != ''
        uses: Ilshidur/action-discord@0.3.2
        env:
          DISCORD_WEBHOOK: ${{ secrets.DISCORD_WEBHOOK }}
        with:
          args: |
            **ðŸ“‹ VCH Changelog (Part 2/3)**
            ${{ steps.changelog.outputs.part2 }}
            
      - name: Send Changelog Part 3 to Discord
        if: success() && steps.changelog.outputs.part3 != ''
        uses: Ilshidur/action-discord@0.3.2
        env:
          DISCORD_WEBHOOK: ${{ secrets.DISCORD_WEBHOOK }}
        with:
          args: |
            **ðŸ“‹ VCH Changelog (Part 3/3)**
            ${{ steps.changelog.outputs.part3 }}